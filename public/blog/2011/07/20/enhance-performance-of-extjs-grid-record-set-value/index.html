
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Enhance Performance of ExtJs Grid Record set value operation - Thinking in Crowd / 鹄思乱想</title>
  <meta name="author" content="鹄思乱想">

  
  <meta name="description" content="When implementing a feature for the project, I encounter one Javascript method that takes around 9 seconds to finish.  Clearly, there is some &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.thinkingincrowd.me/blog/2011/07/20/enhance-performance-of-extjs-grid-record-set-value/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Thinking in Crowd / 鹄思乱想" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37378953-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Thinking in Crowd / 鹄思乱想</a></h1>
  
    <h2>Swan flying in the immense sky</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.thinkingincrowd.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/tags">Tags</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Enhance Performance of ExtJs Grid Record Set Value Operation</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-20T23:25:39+08:00" pubdate data-updated="true">Jul 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>When implementing a feature for the project, I encounter one Javascript method that takes around 9 seconds to finish.  Clearly, there is some performance issue in it.</p>

<p>The method logic is simple.  Take below table&rsquo;s data as an example:</p>

<pre><code>Measurement         XS     S     M     L      XL   XXL
 Sleeve             1      1     0     2      2     2
</code></pre>

<p>Consider above row &ldquo;Sleeve&rdquo; is a Record in ExtJs Grid.  When deleting size S &amp; L column, the figure should change to be:</p>

<pre><code>Measurement         XS     M     XL      XXL
 Sleeve             2      0      4      4
</code></pre>

<p>The intent is to accumulate the figure of the deleted size to the remained ones in one direction from the Standard size M.  Hence, this method requires intensive call on Record.set();  Below is the sudo code.</p>

<pre><code>    var recalculatedGridData = [];
    var colSearchCount = 0;
    for (var rowNo = 0; rowNo &lt; gridStoreLength; rowNo++) {
        ...
        // Calculation logic here to get all the correct data first.
        ...
        recalculatedGridData.push(recordData); // Store the data
    }
    // Reset recalculated data to record
    for (var rowNo = 0; rowNo &lt; recalculatedGridData.length; rowNo++) {
        var recordData = recalculatedGridData[rowNo];
        var record = store.virtualGetAt(recordData.rowNo);
        for (var colNo = 0; colNo &lt; recordData.cells.length; colNo++) {
            var cell = recordData.cells[colNo];
            record.set(cell.name, cell.value);
        }
        // record.batchSet(recordData.cells); // Enhanced version to batch set
    }
</code></pre>

<p>The performance tuning rule is first to find out the part where the bigger portion of the time used in.  This method contains two major for loop.  One is the first for calculation logic and the second is just purely setting data to the right cell.</p>

<p>The total time of the method takes around 9 seconds when the involved number of records are 42 and each have 5 cells affected.  It&rsquo;s found that 99% of the time spent on the second for loop.</p>

<p>After testing more intensively, each record.set() takes around 0.05 second.  That is why operation on around 42 * 5 = 210 cells takes 9 seconds.</p>

<p>OK.  Root cause is found and it&rsquo;s time to see why it takes so long to call record.set().  After checking on the source of ExtJs Record and Store object.</p>

<p>In Record.js:</p>

<pre><code>set : function(name, value){
        var encode = Ext.isPrimitive(value) ? String : Ext.encode;
        if(encode(this.data[name]) == encode(value)) {
            return;
        }
        this.dirty = true;
        if(!this.modified){
            this.modified = {};
        }
        if(this.modified[name] === undefined){
            this.modified[name] = this.data[name];
        }
        this.data[name] = value;
        if(!this.editing){
            this.afterEdit();
        }
    },

    // private
    afterEdit : function(){
        if (this.store != undefined &amp;&amp; typeof this.store.afterEdit == "function") {
            this.store.afterEdit(this);
        }
    },
</code></pre>

<p>In Store.js:</p>

<pre><code>    afterEdit : function(record){
        if(this.modified.indexOf(record) == -1){
            this.modified.push(record);
        }
        this.fireEvent('update', this, record, Ext.data.Record.EDIT);
    },
</code></pre>

<p>You can find that each Record.set() will call store.afterEdit() with its own as parameter.  Hence, I am considering batch update all cells in one record and then trigger Record.afterEdit() method.  Below is the &ldquo;cracked&rdquo; method added for batch set data.</p>

<pre><code>batchSet : function(cells){
        for (var i = cells.length; i--;) {
            var name = cells[i].name;
            var value = cells[i].value;
            var encode = Ext.isPrimitive(value) ? String : Ext.encode;
            if(encode(this.data[name]) == encode(value)) {
                return;
            }
            this.dirty = true;
            if(!this.modified){
                this.modified = {};
            }
            if(this.modified[name] === undefined){
                this.modified[name] = this.data[name];
            }
            this.data[name] = value;
        }
        if(!this.editing){
            this.afterEdit();
        }
    },
</code></pre>

<p>After testing, operation based on the same data set takes around 3.5 seconds now.  Suddenly drops 60%!</p>

<p>Kind of satisfied on what I have changed on this.  However, I think there should be room to improve.  Any Comment?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">鹄思乱想</span></span>

      








  


<time datetime="2011-07-20T23:25:39+08:00" pubdate data-updated="true">Jul 20<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/sword/'>Sword</a>
  
</span>


      

<span class="tags">
  
    <a class='tag' href='/tags/extjs/'>ExtJs</a>, <a class='tag' href='/tags/javascript/'>Javascript</a>, <a class='tag' href='/tags/performance/'>Performance</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/07/20/valueofstone/" title="Previous Post: 一个石头值多少钱">&laquo; 一个石头值多少钱</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/07/27/annoying-titles-of-two-articles/" title="Next Post: 看了让我有点蛋疼的文章标题">看了让我有点蛋疼的文章标题 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <iframe src="http://rcm-na.amazon-adsystem.com/e/cm?t=thinkingincro-20&o=1&p=12&l=ur1&category=books&banner=0Y6NKQA0Z279VVYY1382&f=ifr" width="275" height="250" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0"></iframe>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/04/2013-retrospect-and-2014-goal-setting/">2013 Retrospect and 2014 Goal Setting</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/25/how-to-use-ext-ajax-in-promise-style-and-test-it/">How to use Ext Ajax in Promise style and test it</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/14/jingjs-2013-fun/">京JS 2013 之挖坑自埋与神打击</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/13/callbacks-are-imperative/">回调函数是指令式的，Promise 是函数式的：Node 错失的最大机会</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/24/thanks-to-everyone-zach-lendon-github-angularjs/">Thanks to everyone, Zach Lendon, Github, AngularJS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/29/how-to-support-page-content-i18n-in-angularjs/">How to support page content i18n in AngularJS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/29/startup-review-network/">至关重要的关系</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/26/startup-review-permanent-beta/">永久测试之心, 寻求真我</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/14/function-definition-this-and-bind-in-javascript/">Function definition, this and bind in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/08/how-to-verify-json-data-with-angularjs-httpbackend/">How to verify JSON data with AngularJS $httpBackend</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/life'>Life (6)</a></li><li><a href='/blog/categories/sword'>Sword (21)</a></li><li><a href='/blog/categories/think'>Think (29)</a></li></ul>
</section>
<section>
  <h1>Tag Cloud</h1>
  <ul class="tag-cloud">
    <li><a style="font-size: 60%" href="/tags/amd/">AMD</a></li>
<li><a style="font-size: 60%" href="/tags/adapt/">Adapt</a></li>
<li><a style="font-size: 86%" href="/tags/ajax/">Ajax</a></li>
<li><a style="font-size: 120%" href="/tags/angularjs/">AngularJS</a></li>
<li><a style="font-size: 60%" href="/tags/blogging/">Blogging</a></li>
<li><a style="font-size: 111%" href="/tags/book/">Book</a></li>
<li><a style="font-size: 60%" href="/tags/callback/">Callback</a></li>
<li><a style="font-size: 86%" href="/tags/change/">Change</a></li>
<li><a style="font-size: 101%" href="/tags/coding/">Coding</a></li>
<li><a style="font-size: 60%" href="/tags/connect/">Connect</a></li>
<li><a style="font-size: 60%" href="/tags/db/">DB</a></li>
<li><a style="font-size: 86%" href="/tags/design/">Design</a></li>
<li><a style="font-size: 86%" href="/tags/destiny/">Destiny</a></li>
<li><a style="font-size: 86%" href="/tags/directive/">Directive</a></li>
<li><a style="font-size: 60%" href="/tags/excel/">Excel</a></li>
<li><a style="font-size: 60%" href="/tags/execution-context/">Execution context</a></li>
<li><a style="font-size: 132%" href="/tags/extjs/">ExtJs</a></li>
<li><a style="font-size: 60%" href="/tags/function-definition/">Function definition</a></li>
<li><a style="font-size: 86%" href="/tags/functional-programming/">Functional Programming</a></li>
<li><a style="font-size: 86%" href="/tags/gtd/">GTD</a></li>
<li><a style="font-size: 101%" href="/tags/goal/">Goal</a></li>
<li><a style="font-size: 60%" href="/tags/health/">Health</a></li>
<li><a style="font-size: 86%" href="/tags/httpbackend/">HttpBackend</a></li>
<li><a style="font-size: 60%" href="/tags/influence/">Influence</a></li>
<li><a style="font-size: 60%" href="/tags/jawr/">JAWR</a></li>
<li><a style="font-size: 60%" href="/tags/jsconf/">JSConf</a></li>
<li><a style="font-size: 86%" href="/tags/json/">JSON</a></li>
<li><a style="font-size: 132%" href="/tags/jasmine/">Jasmine</a></li>
<li><a style="font-size: 165%" href="/tags/javascript/">Javascript</a></li>
<li><a style="font-size: 60%" href="/tags/jingjs/">JingJS</a></li>
<li><a style="font-size: 126%" href="/tags/management/">Management</a></li>
<li><a style="font-size: 86%" href="/tags/maven/">Maven</a></li>
<li><a style="font-size: 60%" href="/tags/mocha/">Mocha</a></li>
<li><a style="font-size: 101%" href="/tags/mock/">Mock</a></li>
<li><a style="font-size: 60%" href="/tags/modularization/">Modularization</a></li>
<li><a style="font-size: 60%" href="/tags/mongodb/">MongoDB</a></li>
<li><a style="font-size: 111%" href="/tags/mood/">Mood</a></li>
<li><a style="font-size: 60%" href="/tags/network/">Network</a></li>
<li><a style="font-size: 120%" href="/tags/nodejs/">NodeJS</a></li>
<li><a style="font-size: 60%" href="/tags/opportunity/">Opportunity</a></li>
<li><a style="font-size: 60%" href="/tags/poi/">POI</a></li>
<li><a style="font-size: 60%" href="/tags/performance/">Performance</a></li>
<li><a style="font-size: 60%" href="/tags/permanent/">Permanent</a></li>
<li><a style="font-size: 60%" href="/tags/pomodoro/">Pomodoro</a></li>
<li><a style="font-size: 86%" href="/tags/productivity/">Productivity</a></li>
<li><a style="font-size: 86%" href="/tags/promise/">Promise</a></li>
<li><a style="font-size: 158%" href="/tags/retrospect/">Retrospect</a></li>
<li><a style="font-size: 60%" href="/tags/risk/">Risk</a></li>
<li><a style="font-size: 60%" href="/tags/spa/">SPA</a></li>
<li><a style="font-size: 60%" href="/tags/share/">Share</a></li>
<li><a style="font-size: 60%" href="/tags/sinon-js/">Sinon.js</a></li>
<li><a style="font-size: 101%" href="/tags/startup/">Startup</a></li>
<li><a style="font-size: 60%" href="/tags/string-interpolation/">String interpolation</a></li>
<li><a style="font-size: 60%" href="/tags/stuff/">Stuff</a></li>
<li><a style="font-size: 86%" href="/tags/time-management/">Time Management</a></li>
<li><a style="font-size: 101%" href="/tags/trip/">Trip</a></li>
<li><a style="font-size: 60%" href="/tags/ued/">UED</a></li>
<li><a style="font-size: 60%" href="/tags/ui/">UI</a></li>
<li><a style="font-size: 126%" href="/tags/unittest/">UnitTest</a></li>
<li><a style="font-size: 60%" href="/tags/webassemble/">Webassemble</a></li>
<li><a style="font-size: 60%" href="/tags/weblogic/">Weblogic</a></li>
<li><a style="font-size: 60%" href="/tags/bind/">bind</a></li>
<li><a style="font-size: 86%" href="/tags/i18n/">i18n</a></li>
<li><a style="font-size: 60%" href="/tags/ngclass/">ngClass</a></li>
<li><a style="font-size: 60%" href="/tags/ngrepeat/">ngRepeat</a></li>
<li><a style="font-size: 60%" href="/tags/this/">this</a></li>

  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/kenspirit">@kenspirit</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kenspirit',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<iframe src="http://rcm-cn.amazon-adsystem.com/e/cm?t=thinkingincro-23&o=28&p=11&l=ur1&category=books&banner=0BEDWRCSA5Z6NME9BN82&f=ifr" width="120" height="600" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0"></iframe>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/chengusky@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - 鹄思乱想 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'thinkingincrowd';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.thinkingincrowd.me/blog/2011/07/20/enhance-performance-of-extjs-grid-record-set-value/';
        var disqus_url = 'http://www.thinkingincrowd.me/blog/2011/07/20/enhance-performance-of-extjs-grid-record-set-value/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
