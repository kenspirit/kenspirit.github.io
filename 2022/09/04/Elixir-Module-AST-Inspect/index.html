
 <!DOCTYPE HTML>
<html >
<head>
  <script data-ad-client="ca-pub-3734008573442765" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <meta charset="UTF-8">
  
    <title>Elixir Module AST Inspect | Thinking in Crowd / 鹄思乱想</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="鹄思乱想">
    
    <meta name="description" content="One day, I got a requirement of extracting the public function information from the Elixir Module.  I got no clue how to achieve it at the beginning b">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="kenspirit" />
    <meta name="twitter:title" content="Elixir Module AST Inspect | Thinking in Crowd / 鹄思乱想" />
      
    
    
    <link rel="alternate" href="/atom.xml" title="Thinking in Crowd / 鹄思乱想" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/qmark.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/qmark.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.2.0"></head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Thinking in Crowd / 鹄思乱想" title="Thinking in Crowd / 鹄思乱想"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Thinking in Crowd / 鹄思乱想">Thinking in Crowd / 鹄思乱想</a></h1>
				<h2 class="blog-motto">Swan flying in the immense sky</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/about">About</a></li>
					
						<li><a href="/algorithm">Algorithm</a></li>
					
						<li><a href="/kanban">Kanban</a></li>
					
						<li><a href="/nodeppt">Slideshare</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:www.thinkingincrowd.me">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/09/04/Elixir-Module-AST-Inspect/" title="Elixir Module AST Inspect" itemprop="url">Elixir Module AST Inspect</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://plus.google.com/108764880042816550000?rel=author" title="鹄思乱想" target="_blank" itemprop="author">鹄思乱想</a>
    </p>
  <p class="article-time">
    <time datetime="2022-09-04T12:59:26.000Z" itemprop="datePublished">Sep 4 2022</time>
    Updated:<time datetime="2022-09-04T13:22:50.323Z" itemprop="dateModified">Sep 4 2022</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Through-Documentation"><span class="toc-number">1.</span> <span class="toc-text">Through Documentation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Through-AST"><span class="toc-number">2.</span> <span class="toc-text">Through AST</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-AST-structure"><span class="toc-number">2.1.</span> <span class="toc-text">Module AST structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Block-AST-structure"><span class="toc-number">2.2.</span> <span class="toc-text">Module Block AST structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-AST-structure"><span class="toc-number">2.3.</span> <span class="toc-text">Function AST structure</span></a></li></ol></li></ol>
		</div>
		
		<p>One day, I got a requirement of extracting the public function information from the Elixir Module.  I got no clue how to achieve it at the beginning but it turns out to be an interesting experience afterward.</p>
<h2 id="Through-Documentation"><a href="#Through-Documentation" class="headerlink" title="Through Documentation"></a>Through Documentation</h2><p>Anyone who learns Elixir should be familiar with Hex Docs.  Hence, my first reaction is to see how it works because there should be a way to extract the function signature and documentation.  I found out that I can use <code>Code.fetch_docs</code> as below:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:docs_v1</span>, _, _, _, %&#123;<span class="string">&quot;en&quot;</span> =&gt; module_doc&#125;, _meta, doc_elements&#125; =</span><br><span class="line">  <span class="title class_">Code</span>.fetch_docs(module_or_path)</span><br></pre></td></tr></table></figure>

<p><em>Notes: If a module name is provided, it must be compiled from a file, not directly in Livebook because of <a target="_blank" rel="noopener" href="https://elixirforum.com/t/what-is-the-module-name-compiled-in-livebook/49968/2?u=thinkingincrowd">this</a>.</em></p>
<p>The format of the <code>doc_elements</code> contains most of the information I need: the function signature and documentation.  However, as there are multiple implementations for one of the functions <code>get_best_block_height/2</code>, using <code>Code.fetch_docs</code> cannot deal with this scenario.  How to overcome it?</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;&#123;<span class="symbol">:function</span>, <span class="symbol">:get_best_block_height</span>, <span class="number">1</span>&#125;, <span class="number">35</span>, [<span class="string">&quot;get_best_block_height(endpoint)&quot;</span>],</span><br><span class="line">   %&#123;</span><br><span class="line">     <span class="string">&quot;en&quot;</span> =&gt; <span class="string">&quot;Get best **block height** of Ethereum-type network from given endpoint\n&quot;</span></span><br><span class="line">   &#125;, %&#123;&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="symbol">:function</span>, <span class="symbol">:get_best_block_height</span>, <span class="number">2</span>&#125;, <span class="number">14</span>, [<span class="string">&quot;get_best_block_height(network, endpoint)&quot;</span>],</span><br><span class="line">   %&#123;</span><br><span class="line">     <span class="string">&quot;en&quot;</span> =&gt;</span><br><span class="line">       <span class="string">&quot;Get best **block height** from given endpoint of either:\n* Ethereum\n* Arweave\n\nNot implemented for BTC yet\n&quot;</span></span><br><span class="line">   &#125;, %&#123;&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="symbol">:function</span>, <span class="symbol">:get_module_doc</span>, <span class="number">0</span>&#125;, <span class="number">9</span>, [<span class="string">&quot;get_module_doc()&quot;</span>], %&#123;<span class="string">&quot;en&quot;</span> =&gt; <span class="string">&quot;Get module doc\n&quot;</span>&#125;, %&#123;&#125;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="Through-AST"><a href="#Through-AST" class="headerlink" title="Through AST"></a>Through AST</h2><p>Anyone who has some years’ programming experience should know or hear about AST (Abstract Syntax Tree).  Abstract Syntax Trees are data structures widely used in compilers to represent the structure of program code.</p>
<p>Elixir has great Meta-programming capability and AST can do the job.  I did not come to AST in the first place due to the deep down scare in me facing this advanced &amp; complicated technique.</p>
<p>However, it’s actually not as complex as I thought, at least for achieving what I want to do.  According to Elixir’s <a target="_blank" rel="noopener" href="https://hexdocs.pm/elixir/syntax-reference.html#the-elixir-ast">Documentation</a>:</p>
<blockquote>
<p>The building block of Elixir’s AST is a call, such as:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>which is represented as a tuple with three elements:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:sum</span>, meta, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>the first element is an atom (or another tuple), the second element is a list of two-element tuples with metadata (such as line numbers) and the third is a list of arguments.</p>
<p>We can retrieve the AST for any Elixir expression by calling quote:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">  sum()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">#=&gt; &#123;:sum, [], []&#125;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>It is not difficult to understand the AST for a call statement and how to generate the AST.  How about the AST for a module?  Actually, using the <code>quote</code> approach cannot get a module’s AST.  We can load it from the source file using:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source_path |&gt; <span class="title class_">File</span>.read!() |&gt; <span class="title class_">Code</span>.string_to_quoted()</span><br></pre></td></tr></table></figure>

<h3 id="Module-AST-structure"><a href="#Module-AST-structure" class="headerlink" title="Module AST structure"></a>Module AST structure</h3><p><img src="https://github.com/kenspirit/blog-cdn-data/raw/master/elixir-module-ast-inspect.png" alt="Elixir Sequence Server Hierchary"></p>
<p>By comparing the Elixir source code and generated AST structure, we can see that AST of the whole module fulfills the basic structure above.  The argument list is an alias and a do block:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:defmodule</span>, [<span class="symbol">line:</span> <span class="number">1</span>],</span><br><span class="line"> [</span><br><span class="line">   &#123;<span class="symbol">:__aliases__</span>, [<span class="symbol">line:</span> <span class="number">1</span>], [<span class="symbol">:BestBlockHeightGetter</span>]&#125;,</span><br><span class="line">   [</span><br><span class="line">     <span class="symbol">do:</span> &#123;<span class="symbol">:__block__</span>, [], []&#125;</span><br><span class="line">   ]</span><br><span class="line"> ]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Module-Block-AST-structure"><a href="#Module-Block-AST-structure" class="headerlink" title="Module Block AST structure"></a>Module Block AST structure</h3><p>The block AST shows clearly that its argument list contains separate ASTs for every attribute (starting with <code>:@</code> atom) and function (starting with <code>:def</code> atom).</p>
<h3 id="Function-AST-structure"><a href="#Function-AST-structure" class="headerlink" title="Function AST structure"></a>Function AST structure</h3><p>As we can see, for simple functions without guard:</p>
<ul>
<li>If it has no parameters, the <code>get_module_doc</code> function (<code>[line: 12]</code>), its argument list in AST is nil.</li>
<li>If it has parameters, the <code>get_best_block_height</code> function (<code>[line: 26]</code>, <code>[line: 31]</code> and <code>[line: 39]</code>), the parameter is either a constant value or an AST.</li>
</ul>
<p>The function with guard is a bit more complex but you should still be able to recognize the components.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get_module_doc</span></span><br><span class="line">&#123;<span class="symbol">:def</span>, [<span class="symbol">line:</span> <span class="number">12</span>],</span><br><span class="line"> [</span><br><span class="line">   &#123;<span class="symbol">:get_module_doc</span>, [<span class="symbol">line:</span> <span class="number">12</span>], <span class="literal">nil</span>&#125;,</span><br><span class="line">   [<span class="symbol">do:</span> &#123;<span class="symbol">:</span>@, [<span class="symbol">line:</span> <span class="number">12</span>], [&#123;<span class="symbol">:moduledoc</span>, [<span class="symbol">line:</span> <span class="number">12</span>], <span class="literal">nil</span>&#125;]&#125;]</span><br><span class="line"> ]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># get_best_block_height</span></span><br><span class="line">&#123;<span class="symbol">:def</span>, [<span class="symbol">line:</span> <span class="number">26</span>],</span><br><span class="line"> [</span><br><span class="line">   &#123;<span class="symbol">:get_best_block_height</span>, [<span class="symbol">line:</span> <span class="number">26</span>],</span><br><span class="line">    [<span class="string">&quot;ethereum&quot;</span>, &#123;<span class="symbol">:</span>\\, [<span class="symbol">line:</span> <span class="number">26</span>], [&#123;<span class="symbol">:endpoint</span>, [<span class="symbol">line:</span> <span class="number">26</span>], <span class="literal">nil</span>&#125;, <span class="string">&quot;eth&quot;</span>]&#125;]&#125;,</span><br><span class="line">   [</span><br><span class="line">     <span class="symbol">do:</span> &#123;<span class="symbol">:__block__</span>, [], []&#125;</span><br><span class="line">   ]</span><br><span class="line"> ]&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="symbol">:def</span>, [<span class="symbol">line:</span> <span class="number">26</span>],</span><br><span class="line"> [</span><br><span class="line">   &#123;<span class="symbol">:get_best_block_height</span>, [<span class="symbol">line:</span> <span class="number">31</span>], [<span class="string">&quot;arweave&quot;</span>, &#123;<span class="symbol">:endpoint</span>, [<span class="symbol">line:</span> <span class="number">26</span>], <span class="literal">nil</span>&#125;]&#125;,</span><br><span class="line">   [</span><br><span class="line">     <span class="symbol">do:</span> &#123;<span class="symbol">:__block__</span>, [], []&#125;</span><br><span class="line">   ]</span><br><span class="line"> ]&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="symbol">:def</span>, [<span class="symbol">line:</span> <span class="number">39</span>],</span><br><span class="line"> [</span><br><span class="line">   &#123;<span class="symbol">:get_best_block_height</span>, [<span class="symbol">line:</span> <span class="number">39</span>], [&#123;<span class="symbol">:endpoint</span>, [<span class="symbol">line:</span> <span class="number">39</span>], <span class="literal">nil</span>&#125;]&#125;,</span><br><span class="line">   [</span><br><span class="line">     <span class="symbol">do:</span> &#123;<span class="symbol">:__block__</span>, [], []&#125;</span><br><span class="line">   ]</span><br><span class="line"> ]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># With Guards</span></span><br><span class="line">&#123;<span class="symbol">:def</span>, [<span class="symbol">line:</span> <span class="number">22</span>],</span><br><span class="line"> [</span><br><span class="line">   &#123;<span class="symbol">:when</span>, [<span class="symbol">line:</span> <span class="number">22</span>],</span><br><span class="line">    [</span><br><span class="line">      &#123;<span class="symbol">:get_best_block_height</span>, [<span class="symbol">line:</span> <span class="number">22</span>],</span><br><span class="line">       [&#123;<span class="symbol">:network</span>, [<span class="symbol">line:</span> <span class="number">22</span>], <span class="literal">nil</span>&#125;, &#123;<span class="symbol">:_endpoint</span>, [<span class="symbol">line:</span> <span class="number">22</span>], <span class="literal">nil</span>&#125;]&#125;,</span><br><span class="line">      &#123;<span class="symbol">:==</span>, [<span class="symbol">line:</span> <span class="number">22</span>], [&#123;<span class="symbol">:network</span>, [<span class="symbol">line:</span> <span class="number">22</span>], <span class="literal">nil</span>&#125;, <span class="string">&quot;btc&quot;</span>]&#125;</span><br><span class="line">    ]&#125;,</span><br><span class="line">   [<span class="symbol">do:</span> &#123;<span class="symbol">:-</span>, [<span class="symbol">line:</span> <span class="number">23</span>], [<span class="number">1</span>]&#125;]</span><br><span class="line"> ]&#125;</span><br></pre></td></tr></table></figure>

<p>Hence, based on this generated AST, I can get back the function signature using this code snippet (I know the part handling the <code>when</code> case is a bit ugly).</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:ok</span>, &#123;<span class="symbol">:defmodule</span>, _meta, [_, [<span class="symbol">do:</span> &#123;<span class="symbol">:__block__</span>, _, block_statements&#125;]]&#125;&#125; =</span><br><span class="line">  source_file_path |&gt; <span class="title class_">File</span>.read!() |&gt; <span class="title class_">Code</span>.string_to_quoted()</span><br><span class="line"></span><br><span class="line">quote_arg = <span class="keyword">fn</span> arg -&gt;</span><br><span class="line">  <span class="keyword">if</span> is_binary(arg), <span class="symbol">do:</span> <span class="string">&quot;\&quot;<span class="subst">#&#123;arg&#125;</span>\&quot;&quot;</span>, <span class="symbol">else:</span> arg</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">parse_arg = <span class="keyword">fn</span> arg -&gt;</span><br><span class="line">  <span class="keyword">case</span> arg <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:</span>\\, _, [&#123;arg_name, _, _&#125;, actual]&#125; -&gt;</span><br><span class="line">      <span class="string">&quot;<span class="subst">#&#123;arg_name&#125;</span> \\\\ <span class="subst">#&#123;quote_arg.(actual)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    &#123;arg_name, _, _&#125; -&gt;</span><br><span class="line">      arg_name</span><br><span class="line"></span><br><span class="line">    _ -&gt;</span><br><span class="line">      quote_arg.(arg)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">block_statements</span><br><span class="line">|&gt; <span class="title class_">Enum</span>.filter(<span class="keyword">fn</span> statement -&gt;</span><br><span class="line">  <span class="keyword">case</span> statement <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:def</span>, _meta, _args&#125; -&gt;</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    _ -&gt;</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">|&gt; <span class="title class_">Enum</span>.map(<span class="keyword">fn</span> &#123;<span class="symbol">:def</span>, _meta, [signature, _block]&#125; -&gt;</span><br><span class="line">  signature</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">|&gt; <span class="title class_">Enum</span>.map(<span class="keyword">fn</span> fun_ast -&gt;</span><br><span class="line">  <span class="keyword">case</span> fun_ast <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:when</span>, _meta, [&#123;fun_name, _, args&#125;, &#123;operator, _, [arg1, arg2]&#125;]&#125; -&gt;</span><br><span class="line">      <span class="string">&quot;<span class="subst">#&#123;fun_name&#125;</span>(<span class="subst">#&#123;<span class="title class_">Enum</span>.map(args, &amp;parse_arg.(&amp;<span class="number">1</span>)) |&gt; <span class="title class_">Enum</span>.join(<span class="string">&quot;, &quot;</span>)&#125;</span>) when <span class="subst">#&#123;parse_arg.(arg1)&#125;</span> <span class="subst">#&#123;operator&#125;</span> <span class="subst">#&#123;parse_arg.(arg2)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    &#123;fun_name, _meta, <span class="literal">nil</span>&#125; -&gt;</span><br><span class="line">      <span class="string">&quot;<span class="subst">#&#123;fun_name&#125;</span>()&quot;</span></span><br><span class="line"></span><br><span class="line">    &#123;fun_name, _meta, args&#125; -&gt;</span><br><span class="line">      <span class="string">&quot;<span class="subst">#&#123;fun_name&#125;</span>(<span class="subst">#&#123;<span class="title class_">Enum</span>.map(args, &amp;parse_arg.(&amp;<span class="number">1</span>)) |&gt; <span class="title class_">Enum</span>.join(<span class="string">&quot;, &quot;</span>)&#125;</span>)&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">|&gt; <span class="title class_">Enum</span>.each(&amp;<span class="title class_">IO</span>.puts/<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>The output would be:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get_module_doc()</span><br><span class="line">get_best_block_height(network, _endpoint) <span class="keyword">when</span> network == <span class="string">&quot;btc&quot;</span></span><br><span class="line">get_best_block_height(<span class="string">&quot;ethereum&quot;</span>, endpoint \\ <span class="string">&quot;eth&quot;</span>)</span><br><span class="line">get_best_block_height(<span class="string">&quot;arweave&quot;</span>, endpoint)</span><br><span class="line">get_best_block_height(endpoint)</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Sword/">Sword</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Elixir/">Elixir</a>
  </div>


<div class="article-share" id="share">

  <div data-url="http://www.thinkingincrowd.me/2022/09/04/Elixir-Module-AST-Inspect/" data-title="Elixir Module AST Inspect | Thinking in Crowd / 鹄思乱想" data-tsina="kenspirit" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2021/10/04/broadway-source-reading-part-5-subscription-and-concurrency/"  title="Broadway Source Reading (Part 5 - Subscription &amp; Concurrency)">
 <strong>NEXT:</strong><br/> 
 <span>Broadway Source Reading (Part 5 - Subscription &amp; Concurrency)
</span>
</a>
</div>

</nav>

	<section class="comment">
	
  
    <div id="disqus_thread"></div>
  
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Through-Documentation"><span class="toc-number">1.</span> <span class="toc-text">Through Documentation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Through-AST"><span class="toc-number">2.</span> <span class="toc-text">Through AST</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-AST-structure"><span class="toc-number">2.1.</span> <span class="toc-text">Module AST structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Block-AST-structure"><span class="toc-number">2.2.</span> <span class="toc-text">Module Block AST structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-AST-structure"><span class="toc-number">2.3.</span> <span class="toc-text">Function AST structure</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/Life/" title="Life">Life<sup>7</sup></a></li>
		
			<li><a href="/categories/Psychology/" title="Psychology">Psychology<sup>21</sup></a></li>
		
			<li><a href="/categories/Sword/" title="Sword">Sword<sup>66</sup></a></li>
		
			<li><a href="/categories/Think/" title="Think">Think<sup>80</sup></a></li>
		
		</ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/AWS/" style="font-size: 10.71px;">AWS</a> <a href="/tags/Ajax/" style="font-size: 10.71px;">Ajax</a> <a href="/tags/AngularJS/" style="font-size: 12.86px;">AngularJS</a> <a href="/tags/Architecture/" style="font-size: 10.71px;">Architecture</a> <a href="/tags/Asynchronous/" style="font-size: 10.71px;">Asynchronous</a> <a href="/tags/Attention/" style="font-size: 10px;">Attention</a> <a href="/tags/BTC/" style="font-size: 10px;">BTC</a> <a href="/tags/Babel/" style="font-size: 10px;">Babel</a> <a href="/tags/Belief/" style="font-size: 10.71px;">Belief</a> <a href="/tags/Bitcoin/" style="font-size: 10.71px;">Bitcoin</a> <a href="/tags/Blockchain/" style="font-size: 16.43px;">Blockchain</a> <a href="/tags/Blogging/" style="font-size: 10px;">Blogging</a> <a href="/tags/Book/" style="font-size: 12.86px;">Book</a> <a href="/tags/Bundling/" style="font-size: 10.71px;">Bundling</a> <a href="/tags/Business-Logic/" style="font-size: 11.43px;">Business Logic</a> <a href="/tags/Cache/" style="font-size: 10.71px;">Cache</a> <a href="/tags/Change/" style="font-size: 13.57px;">Change</a> <a href="/tags/Choice/" style="font-size: 10.71px;">Choice</a> <a href="/tags/Coach/" style="font-size: 10px;">Coach</a> <a href="/tags/Communication/" style="font-size: 12.86px;">Communication</a> <a href="/tags/Conflict/" style="font-size: 10px;">Conflict</a> <a href="/tags/Courage/" style="font-size: 10px;">Courage</a> <a href="/tags/DDD/" style="font-size: 10px;">DDD</a> <a href="/tags/Dapp/" style="font-size: 13.57px;">Dapp</a> <a href="/tags/Data-Modeling/" style="font-size: 10.71px;">Data Modeling</a> <a href="/tags/Database/" style="font-size: 10.71px;">Database</a> <a href="/tags/Death/" style="font-size: 10px;">Death</a> <a href="/tags/Delegation/" style="font-size: 10.71px;">Delegation</a> <a href="/tags/Design/" style="font-size: 11.43px;">Design</a> <a href="/tags/Destiny/" style="font-size: 11.43px;">Destiny</a> <a href="/tags/Distributed/" style="font-size: 12.14px;">Distributed</a> <a href="/tags/EOS/" style="font-size: 10px;">EOS</a> <a href="/tags/Education/" style="font-size: 10.71px;">Education</a> <a href="/tags/Elixir/" style="font-size: 17.14px;">Elixir</a> <a href="/tags/Emotion/" style="font-size: 10.71px;">Emotion</a> <a href="/tags/Empathy/" style="font-size: 11.43px;">Empathy</a> <a href="/tags/Ethereum/" style="font-size: 13.57px;">Ethereum</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/Experience/" style="font-size: 10.71px;">Experience</a> <a href="/tags/ExtJS/" style="font-size: 15px;">ExtJS</a> <a href="/tags/Father/" style="font-size: 10px;">Father</a> <a href="/tags/First-Principle/" style="font-size: 10.71px;">First Principle</a> <a href="/tags/Full-Stack/" style="font-size: 10px;">Full-Stack</a> <a href="/tags/Functional-Programming/" style="font-size: 14.29px;">Functional Programming</a> <a href="/tags/Goal/" style="font-size: 13.57px;">Goal</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Habit/" style="font-size: 10.71px;">Habit</a> <a href="/tags/Health/" style="font-size: 10.71px;">Health</a> <a href="/tags/Idempotency/" style="font-size: 10.71px;">Idempotency</a> <a href="/tags/Influence/" style="font-size: 10px;">Influence</a> <a href="/tags/Integration/" style="font-size: 10px;">Integration</a> <a href="/tags/JSConf/" style="font-size: 10.71px;">JSConf</a> <a href="/tags/JSON/" style="font-size: 10.71px;">JSON</a> <a href="/tags/Jasmine/" style="font-size: 14.29px;">Jasmine</a> <a href="/tags/Javascript/" style="font-size: 20px;">Javascript</a> <a href="/tags/Kanban/" style="font-size: 14.29px;">Kanban</a> <a href="/tags/Leadership/" style="font-size: 11.43px;">Leadership</a> <a href="/tags/Learning/" style="font-size: 10.71px;">Learning</a> <a href="/tags/Love/" style="font-size: 10.71px;">Love</a> <a href="/tags/MVC/" style="font-size: 15px;">MVC</a> <a href="/tags/Management/" style="font-size: 14.29px;">Management</a> <a href="/tags/Mature/" style="font-size: 10px;">Mature</a> <a href="/tags/Maven/" style="font-size: 10.71px;">Maven</a> <a href="/tags/MicroServices/" style="font-size: 10px;">MicroServices</a> <a href="/tags/Milestone/" style="font-size: 10px;">Milestone</a> <a href="/tags/Mnesia/" style="font-size: 11.43px;">Mnesia</a> <a href="/tags/Mocha/" style="font-size: 10px;">Mocha</a> <a href="/tags/Mock/" style="font-size: 11.43px;">Mock</a> <a href="/tags/Modularization/" style="font-size: 10.71px;">Modularization</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mood/" style="font-size: 12.14px;">Mood</a> <a href="/tags/Network/" style="font-size: 10px;">Network</a> <a href="/tags/Node-js/" style="font-size: 17.86px;">Node.js</a> <a href="/tags/OTP/" style="font-size: 10.71px;">OTP</a> <a href="/tags/Opportunity/" style="font-size: 10px;">Opportunity</a> <a href="/tags/POI/" style="font-size: 10px;">POI</a> <a href="/tags/Performance/" style="font-size: 10px;">Performance</a> <a href="/tags/Politics/" style="font-size: 10.71px;">Politics</a> <a href="/tags/Problem-Solving/" style="font-size: 11.43px;">Problem Solving</a> <a href="/tags/Productivity/" style="font-size: 11.43px;">Productivity</a> <a href="/tags/Programming/" style="font-size: 15.71px;">Programming</a> <a href="/tags/Promise/" style="font-size: 11.43px;">Promise</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Relationship/" style="font-size: 18.57px;">Relationship</a> <a href="/tags/Responsibility/" style="font-size: 11.43px;">Responsibility</a> <a href="/tags/Retrospect/" style="font-size: 19.29px;">Retrospect</a> <a href="/tags/Risk/" style="font-size: 10px;">Risk</a> <a href="/tags/Rule/" style="font-size: 10px;">Rule</a> <a href="/tags/SPA/" style="font-size: 10px;">SPA</a> <a href="/tags/Scrum/" style="font-size: 10px;">Scrum</a> <a href="/tags/Security/" style="font-size: 10px;">Security</a> <a href="/tags/Server/" style="font-size: 10.71px;">Server</a> <a href="/tags/Sharing/" style="font-size: 10px;">Sharing</a> <a href="/tags/Smart-Contract/" style="font-size: 13.57px;">Smart Contract</a> <a href="/tags/Source-Reading/" style="font-size: 12.86px;">Source Reading</a> <a href="/tags/Startup/" style="font-size: 12.14px;">Startup</a> <a href="/tags/Statistics/" style="font-size: 10px;">Statistics</a> <a href="/tags/Supervisor/" style="font-size: 10.71px;">Supervisor</a> <a href="/tags/Support/" style="font-size: 10px;">Support</a> <a href="/tags/Time-Management/" style="font-size: 10.71px;">Time Management</a> <a href="/tags/Trip/" style="font-size: 11.43px;">Trip</a> <a href="/tags/Tutorial/" style="font-size: 15px;">Tutorial</a> <a href="/tags/TypeScript/" style="font-size: 10.71px;">TypeScript</a> <a href="/tags/UED/" style="font-size: 10px;">UED</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/Unit-Test/" style="font-size: 15px;">Unit Test</a> <a href="/tags/Visualization/" style="font-size: 10px;">Visualization</a> <a href="/tags/Wechat/" style="font-size: 15px;">Wechat</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> On the road to be a good father, husband, son and web developer, specialized in JS <br/>
			Playing around with Node.js, AngularJS.  Powering thinking through visualization.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/kenspirit" target="_blank" title="weibo"></a>
		
		
		<a href="https://twitter.com/kenspirit" target="_blank" title="twitter"></a>
		
		
		<a href="https://github.com/kenspirit" target="_blank" title="github"></a>
		
		
		<a href="https://www.facebook.com/kenspirit" target="_blank" title="facebook"></a>
		
		
        <a href="https://www.linkedin.com/thinkingincrowd" target="_blank" title="linkedin"></a>
    
    
		  <script src='https://unpkg.com/mermaid@8.9.2/dist/mermaid.min.js'></script>
		  <script>
		    if (window.mermaid) {
		      mermaid.initialize({{ JSON.stringify(config.mermaid.options) }});
		    }
		  </script>
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2022 
		
		<a href="http://www.thinkingincrowd.me" target="_blank" title="鹄思乱想">鹄思乱想</a>
		
		</p>
</div>
</footer>
    
<script>
  var disqus_shortname = 'thinkingincrowd';
  
  var disqus_url = 'http://www.thinkingincrowd.me/2022/09/04/Elixir-Module-AST-Inspect/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>





<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-37378953-1', 'www.thinkingincrowd.me');  
ga('send', 'pageview');
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?796436d5d2646bb3157d9ac5bd7e7025";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </body>
</html>

